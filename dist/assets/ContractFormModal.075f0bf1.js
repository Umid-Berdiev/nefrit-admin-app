import{_ as D}from"./VModal.7c3df6a9.js";import{K as q,r,m as $,o as x,w as B,E,p as L,q as k,s as i,y as o,f as n,M as l,D as _,H as P,C as z,V as H}from"./index.f060b7c6.js";import{_ as K}from"./VFileInput.5ba11aca.js";import{a as R,_ as T}from"./VControl.068ba628.js";import{_ as G}from"./VField.17e54227.js";import{u as J}from"./vue-i18n.runtime.esm-bundler.1634ed66.js";import{b as Q,u as W,d as X}from"./index.fc264705.js";import{g as Y,h as Z}from"./index.acac9876.js";const ee=["onSubmit"],te={class:"columns is-multiline"},ae={class:"column is-12"},le={class:"help has-text-danger"},ne={class:"column is-12"},oe={class:"help has-text-danger"},se={class:"column is-12"},ie={class:"help has-text-danger"},me={class:"column is-12"},de={class:"help has-text-danger"},ce={class:"column is-12"},he=q({props:{modelValue:Boolean,itemId:{type:Number,default:null}},emits:["update:modelValue","update:list"],setup(y,{emit:b}){const u=y,{t:g,locale:j}=J();let v=r(g("Add"));const c=r([]),V=r(),I=r(),a=$({legal_entity_id:null,name:"",payment_amount:0,template_file:"",applications:[]}),f=r([]),d=$({name:"",payment_amount:"",template_file:"",legal_entity_id:"",applications:""});x(async()=>{const t=await Y(j.value);V.value=t}),B(()=>u.itemId,async(t,e)=>{if(t){v.value=g("Edit");const s=await Q(Number(u.itemId));Object.assign(a,s),f.value=s.applications.map(p=>p.id)}},{deep:!0,immediate:!0}),B(()=>a.legal_entity_id,async(t,e)=>{if(a.applications=[],t){const s=await Z(Number(t));I.value=s}},{deep:!0,immediate:!0});async function M(t){try{const e=new FormData;e.append("name",a.name),e.append("payment_amount",a.payment_amount),e.append("template_file",c.value.length?c.value[0]:""),e.append("legal_entity_id",a.legal_entity_id),f.value.forEach(s=>{e.append("applications[]",s)}),u.itemId?await W(u.itemId,e):await X(e),b("update:list"),C()}catch(e){Object.assign(d,e.response?.data?.errors)}}function C(){u.itemId||(v.value=g("Add"),c.value=[],Object.assign(a,{legal_entity_id:null,name:"",payment_amount:0,template_file:"",applications:[]}),Object.assign(d,{name:"",payment_amount:"",template_file:"",applications:"",legal_entity_id:""})),b("update:modelValue",!1)}function N(t){const e=t.target;console.log("files: ",e.files),c.value=e.files&&[e.files[0]]}function O(t){c.value=[]}return(t,e)=>{const s=R,p=G,S=E("Multiselect"),w=T,F=K,U=H,A=D;return L(),k(A,{open:y.modelValue,size:"large",title:l(v),actions:"right",onClose:C},{content:i(()=>[o("form",{id:"contract-form",class:"modal-form",onSubmit:P(M,["prevent"])},[o("div",te,[o("div",ae,[n(p,{label:t.$t("Contract_name"),required:""},{default:i(()=>[n(s,{modelValue:l(a).name,"onUpdate:modelValue":e[0]||(e[0]=m=>l(a).name=m)},null,8,["modelValue"]),o("p",le,_(l(d).name[0]),1)]),_:1},8,["label"])]),o("div",ne,[n(p,{label:t.$t("Contract_amount"),required:""},{default:i(()=>[n(s,{type:"number",modelValue:l(a).payment_amount,"onUpdate:modelValue":e[1]||(e[1]=m=>l(a).payment_amount=m)},null,8,["modelValue"]),o("p",oe,_(l(d).payment_amount[0]),1)]),_:1},8,["label"])]),o("div",se,[n(p,null,{default:i(({id:m})=>[n(w,null,{default:i(()=>[n(S,{modelValue:l(a).legal_entity_id,"onUpdate:modelValue":e[2]||(e[2]=h=>l(a).legal_entity_id=h),attrs:{id:m},searchable:!0,options:V.value,placeholder:t.$t("Select_applicant"),valueProp:"id",label:"name",disabled:Boolean(y.itemId)},null,8,["modelValue","attrs","options","placeholder","disabled"])]),_:2},1024)]),_:1}),o("p",ie,_(l(d).legal_entity_id[0]),1)]),o("div",me,[n(p,null,{default:i(({id:m})=>[n(w,null,{default:i(()=>[n(S,{modelValue:f.value,"onUpdate:modelValue":e[3]||(e[3]=h=>f.value=h),attrs:{id:m},searchable:!1,options:I.value,placeholder:t.$t("Select_statements"),valueProp:"id",label:"code",mode:"tags","close-on-select":!1,disabled:!l(a).legal_entity_id},null,8,["modelValue","attrs","options","placeholder","disabled"])]),_:2},1024)]),_:1}),o("p",de,_(l(d).applications[0]),1)]),o("div",ce,[n(F,{onFileUpload:N,onFileRemove:O,"error-message":l(d).template_file[0],files:c.value,"remote-files":[]},null,8,["error-message","files"])])])],40,ee)]),action:i(({close:m})=>[n(U,{color:"primary",outlined:"",type:"submit",form:"contract-form"},{default:i(()=>[z(_(t.$t("Save")),1)]),_:1})]),_:1},8,["open","title"])}}});export{he as _};
