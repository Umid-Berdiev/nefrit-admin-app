import{_ as q}from"./VModal.vue_vue_type_style_index_0_lang.bc609875.js";import{z as D,V as U,A as c,bu as j,r as z,D as M,o as O,f as R,w as r,j as o,q as n,t as y,E as v,v as T,m as k,a3 as Y,a1 as L,a2 as P,P as G}from"./index.47e107ef.js";import{_ as H}from"./StatusSelect.vue_vue_type_script_setup_true_lang.6239eeaf.js";import{_ as J}from"./VTextarea.8835ff3a.js";import{s as Z,t as ee,v as te,w as ae,x as se,y as oe,z as le,A as ne}from"./index.57dee6dc.js";import{_ as ie}from"./VFileInput.vue_vue_type_script_setup_true_lang.3806c897.js";const ue=["onSubmit"],de={class:"columns is-multiline"},ce={class:"column is-12"},re={class:"help has-text-danger"},me={class:"column is-12"},pe={class:"help has-text-danger"},_e={class:"column is-12"},fe={class:"help has-text-danger"},Be=D({props:{modelValue:Boolean,itemId:{type:Number,default:null},parentId:{type:Number,default:null}},emits:["update:modelValue","update:list"],async setup(S,{emit:$}){let _,w;const m=S,{t:h}=U();let b=c(h("Add"));const f=c(!1),i=c(""),u=c(""),l=c(),I=([_,w]=j(()=>ee()),_=await _,w(),_),p=z({message:"",text:"",status_id:""});M(()=>m.itemId,async d=>{if(!d)b.value=h("Add"),i.value="",u.value="",l.value="";else{b.value=h("Edit");const t=await Z(Number(m.itemId));i.value=t.message,u.value=t.text,l.value=t.status?.id}},{deep:!0,immediate:!0});async function F(d){try{f.value=!0;const t={message:i.value,text:u.value,application_id:m.parentId,status_id:l.value};m.itemId?await te(m.itemId,t):await ae(t),$("update:list"),g()}catch(t){console.log({error:t}),Object.assign(p,t.response?.data?.errors)}finally{f.value=!1}}function g(){i.value="",u.value="",l.value="",Object.assign(p,{message:"",text:"",status_id:""}),$("update:modelValue",!1)}function N(d){p[d.target.name]=""}return(d,t)=>{const E=Y,C=L,B=P,a=J,e=H,s=G,x=q;return O(),R(x,{open:S.modelValue,size:"large",title:v(b),actions:"right",onClose:g},{content:r(()=>[o("form",{id:"notice-form",class:"modal-form",onSubmit:T(F,["prevent"])},[o("div",de,[o("div",ce,[n(B,{label:d.$t("Notice_message"),required:""},{default:r(()=>[n(C,null,{default:r(()=>[n(E,{name:"message",modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=V=>i.value=V),onInput:N},null,8,["modelValue"]),o("p",re,y(v(p).message[0]),1)]),_:1})]),_:1},8,["label"])]),o("div",me,[n(B,{label:d.$t("Notice_details"),required:""},{default:r(()=>[n(C,null,{default:r(()=>[n(a,{name:"text",placeholder:d.$t("Add_text"),modelValue:u.value,"onUpdate:modelValue":t[1]||(t[1]=V=>u.value=V),onInput:N},null,8,["placeholder","modelValue"]),o("p",pe,y(v(p).text[0]),1)]),_:1})]),_:1},8,["label"])]),o("div",_e,[n(e,{name:"status_id",modelValue:l.value,"onUpdate:modelValue":t[2]||(t[2]=V=>l.value=V),list:v(I),"is-required":!0,onChange:N},null,8,["modelValue","list"]),o("p",fe,y(v(p).status_id[0]),1)])])],40,ue)]),action:r(({close:V})=>[n(s,{loading:f.value,color:"primary",outlined:"",type:"submit",form:"notice-form",disabled:f.value},{default:r(()=>[k(y(d.$t("Save")),1)]),_:1},8,["loading","disabled"])]),_:1},8,["open","title"])}}}),ve=["onSubmit"],ge={class:"columns is-multiline"},Ve={class:"column is-12"},he={class:"help has-text-danger"},be={class:"column is-12"},Ie={class:"help has-text-danger"},xe={class:"column is-12"},Ae=D({props:{modelValue:Boolean,itemId:{type:Number,default:null},parentId:{type:Number,default:null}},emits:["update:modelValue","update:list"],async setup(S,{emit:$}){let _,w;const m=S,{t:h}=U();let b=c(h("Add"));const f=c(!1),i=c(""),u=c(),l=c([]),I=c([]),p=c([]),F=([_,w]=j(()=>oe()),_=await _,w(),_),g=z({text:"",status_id:""});M(()=>m.itemId,async(a,e)=>{if(a){b.value=h("Edit");const s=await se(Number(m.itemId));i.value=s.text,u.value=s.status?.id,I.value=s.files}},{deep:!0,immediate:!0});async function N(a){try{f.value=!0;const e={text:i.value,application_id:m.parentId,status_id:u.value,files:l.value,removed_files:p.value},s=new FormData;s.append("text",e.text),s.append("application_id",e.application_id),s.append("status_id",e.status_id),l.value.forEach(x=>{s.append("files[]",x)}),p.value.forEach(x=>{s.append("removes[]",x)}),m.itemId?await le(m.itemId,s):await ne(s),$("update:list"),d()}catch(e){console.log({error:e}),Object.assign(g,e.response?.data?.errors)}finally{f.value=!1}}function d(){b.value=h("Add"),i.value="",u.value="",l.value=[],I.value=[],p.value=[],Object.assign(g,{text:"",status_id:""}),$("update:modelValue",!1)}function t(a){g[a.target.name]=""}function E(a){const e=a.target;console.log("files: ",e.files),e.files&&l.value?.push(e.files[0])}function C(a){l.value=l.value?.filter(e=>e.lastModified!==a)}function B(a){p.value.push(a),I.value=I.value?.filter(e=>e.id!==a)}return(a,e)=>{const s=J,x=L,V=P,K=H,Q=ie,W=G,X=q;return O(),R(X,{open:S.modelValue,size:"large",title:v(b),actions:"right",onClose:d},{content:r(()=>[o("form",{id:"conclusion-form",class:"modal-form",onSubmit:T(N,["prevent"])},[o("div",ge,[o("div",Ve,[n(V,{label:a.$t("conclusion_in_details"),required:""},{default:r(()=>[n(x,null,{default:r(()=>[n(s,{name:"text",placeholder:a.$t("Add_text"),modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=A=>i.value=A),onInput:t},null,8,["placeholder","modelValue"]),o("p",he,y(v(g).text[0]),1)]),_:1})]),_:1},8,["label"])]),o("div",be,[n(K,{name:"status_id",modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=A=>u.value=A),list:v(F),"is-required":!0,onChange:t},null,8,["modelValue","list"]),o("p",Ie,y(v(g).status_id[0]),1)]),o("div",xe,[n(Q,{files:l.value,"remote-files":I.value,onFileUpload:E,onFileRemove:C,onRemoteFileRemove:B,"error-message":""},null,8,["files","remote-files"])])])],40,ve)]),action:r(({close:A})=>[n(W,{loading:f.value,color:"primary",outlined:"",type:"submit",form:"conclusion-form",disabled:f.value},{default:r(()=>[k(y(a.$t("Save")),1)]),_:1},8,["loading","disabled"])]),_:1},8,["open","title"])}}});export{Ae as _,Be as a};
