import{_ as mt}from"./VTabs.9cfeeb2a.js";import{_ as it}from"./ConfirmActionModal.b5fc385f.js";import{_ as ot}from"./VModal.10e121a4.js";import{z as j,V as E,A as _,o as i,f as U,w as l,j as t,q as a,v as ct,m as D,t as e,E as V,P as x,M as _t,e as nt,b as rt,O as J,bv as lt,p as G,i as m,l as C,F as W,s as ft,ad as pt,r as ht,$ as yt,a0 as vt,bP as bt,B as $t}from"./index.273a610c.js";import{_ as gt}from"./VFileInput.aea316c7.js";import{j as wt,h as Vt,k as Ct,l as kt,m as St,n as Nt}from"./index.8585e8c0.js";import{_ as Mt}from"./ContractFormModal.bee3afe5.js";import{b as ut,_ as Pt,a as Dt}from"./VFlexTable.95983495.js";import{_ as At}from"./ListWidgetSingle.ad10bec4.js";import{_ as It}from"./VTag.040fe33c.js";import{_ as at}from"./VFlexItem.321c7bec.js";import{u as st,_ as Ft}from"./VPlaceholderSection.38d45240.js";import{u as Ut}from"./viewWrapper.cfdeea95.js";import{_ as xt}from"./VButtons.7bffbab0.js";import{_ as Lt}from"./StatusTag.8bc8200a.js";import"./VIcon.556f3883.js";import"./index.54ae91bc.js";const Bt=["onSubmit"],Tt={class:"columns is-multiline"},Yt={class:"column is-12"},jt=j({props:{modelValue:{type:Boolean,default:!1},contractId:{default:""},filePropName:null},emits:["update:modelValue","update:data"],setup(c,{emit:n}){const f=c,{t:s,locale:I}=E(),b=_([]),r=_(""),k=_(!1);let S=_(s("Add_file"));async function N($){try{if(k.value=!0,b.value.length){const d=new FormData;d.append(f.filePropName,b.value[0]??""),await wt(Number(f.contractId),d),n("update:data"),p()}else r.value=s("File_upload_field_required")}catch(d){throw d}finally{k.value=!1}}function p(){b.value=[],r.value="",n("update:modelValue",!1)}function u($){const d=$.target;b.value=d.files?.length&&[d.files[0]],r.value=""}function g(){b.value=[]}return($,d)=>{const M=gt,v=x,A=ot;return i(),U(A,{open:c.modelValue,size:"large",title:V(S),actions:"right",onClose:p},{content:l(()=>[t("form",{id:"file-upload-form",class:"modal-form",onSubmit:ct(N,["prevent"])},[t("div",Tt,[t("div",Yt,[a(M,{files:b.value,onFileUpload:u,onFileRemove:g,"error-message":r.value,"remote-files":[]},null,8,["files","error-message"])])])],40,Bt)]),action:l(({close:L})=>[a(v,{color:"primary",outlined:"",type:"submit",form:"file-upload-form",loading:k.value,disabled:k.value},{default:l(()=>[D(e($.$t("Save")),1)]),_:1},8,["loading","disabled"])]),_:1},8,["open","title"])}}});const zt={class:"container is-fluid"},Ot={class:"columns"},Rt={class:"column is-6"},Ht={class:"table is-hoverable is-bordered is-fullwidth mb-5"},Wt={class:"has-text-weight-bold"},Et={class:"has-text-weight-bold"},qt={class:"has-text-weight-bold"},Gt={class:"has-text-weight-bold"},Jt={class:"has-text-weight-bold"},Kt={class:"table is-hoverable is-bordered is-fullwidth"},Qt={class:"has-text-weight-bold"},Xt={class:"is-flex is-align-items-center"},Zt=["href"],te={class:"mr-3"},ee={key:1,class:"has-text-danger"},ae={class:"has-text-weight-bold"},oe={class:"is-flex is-align-items-center"},ne=["href"],le={class:"mr-3"},se={key:1,class:"has-text-danger"},ie={class:"has-text-weight-bold"},ce={class:"is-flex is-align-items-center"},re=["href"],ue={class:"mr-3"},de={key:1,class:"has-text-danger"},me={class:"column is-6"},_e={class:"table is-hoverable is-bordered is-fullwidth"},fe=j({async setup(c){let n,f;const{t:s,locale:I}=E(),b=st(),r=nt(()=>({name:{label:s("Name"),searchable:!0},legal_entity:{label:s("Applicant")},payment_amount:{label:s("Contract_amount")},template_file:{label:s("Template_file")},legal_file:{label:s("Legal_entity_file")},file:{label:s("File")},verified_at:{label:s("Payment_status")},created_at:{label:s("Date")}})),k=rt(),S=_(!1),p=J().params?.id??null,u=_(),g=_(),$=_(""),d=_(!1),M=_();[n,f]=lt(()=>v()),await n,f();async function v(){const o=await Vt(Number(p));u.value=await o,g.value=u.value?.applications}function A(o){$.value=o,S.value=!0}function L(){d.value=!0}async function z(o){M.value=o,b.$patch({confirmModalState:!0})}function O(){k.success(s("Updated_successfully"))}async function h(){await Ct(Number(p),M.value),await v(),P()}function P(){k.success(s("Success"))}return(o,y)=>{const B=G("VueIconify"),q=It,R=At,Q=G("RouterLink"),X=ut,Z=Mt,tt=jt,et=it;return i(),m("div",zt,[t("div",Ot,[t("div",Rt,[a(R,{title:o.$t("Contract_details"),straight:"",class:"list-widget-v3"},{actions:l(()=>[u.value?.verified_at?C("",!0):(i(),m("a",{key:0,href:"javascript:;",onClick:L},[a(B,{icon:"feather:edit-2"})]))]),default:l(()=>[t("table",Ht,[t("tbody",null,[t("tr",null,[t("td",Wt,e(V(r).name.label),1),t("td",null,e(u.value?.name),1)]),t("tr",null,[t("td",Et,e(V(r).payment_amount.label),1),t("td",null,e(u.value?.payment_amount.toLocaleString()),1)]),t("tr",null,[t("td",qt,e(V(r).legal_entity.label),1),t("td",null,e(u.value?.legal_entity?.name),1)]),t("tr",null,[t("td",Gt,e(V(r).created_at.label),1),t("td",null,e(o.$h.formatDate(u.value?.created_at,"DD.MM.YYYY")),1)]),t("tr",null,[t("td",Jt,e(V(r).verified_at.label),1),t("td",null,[a(q,{class:"is-size-6",color:u.value.verified_at?"primary":"warning",rounded:"",label:u.value.verified_at?o.$t("Paid"):o.$t("Not_Paid")},null,8,["color","label"])])])])])]),_:1},8,["title"]),a(R,{title:o.$t("Contract_files_list"),straight:"",class:"list-widget-v3"},{default:l(()=>[t("table",Kt,[t("tbody",null,[t("tr",null,[t("td",Qt,e(V(r).template_file.label),1),t("td",Xt,[u.value?.template_file?(i(),m("a",{key:0,href:u.value?.template_file,class:"has-text-primary",download:""},[t("span",te,e(o.$t("Download")),1),a(B,{icon:"feather:link"})],8,Zt)):(i(),m("span",ee,e(o.$t("No_template_file")),1)),a(x,{class:"ml-auto",color:"primary",rounded:"",icon:"fas fa-plus",onClick:y[0]||(y[0]=w=>A("template_file"))},{default:l(()=>[D(e(o.$t("Upload")),1)]),_:1})])]),t("tr",null,[t("td",ae,e(V(r).legal_file.label),1),t("td",oe,[u.value?.legal_file?(i(),m("a",{key:0,href:u.value?.legal_file,class:"has-text-primary",download:""},[t("span",le,e(o.$t("Download")),1),a(B,{icon:"feather:link"})],8,ne)):(i(),m("span",se,e(o.$t("No_legal_file")),1))])]),t("tr",null,[t("td",ie,e(V(r).file.label),1),t("td",ce,[u.value?.file?(i(),m("a",{key:0,href:u.value?.file,class:"has-text-primary",download:""},[t("span",ue,e(o.$t("Download")),1),a(B,{icon:"feather:link"})],8,re)):(i(),m("span",de,e(o.$t("No_completed_file")),1)),a(x,{class:"ml-auto",color:"primary",rounded:"",icon:"fas fa-plus",onClick:y[1]||(y[1]=w=>A("file"))},{default:l(()=>[D(e(o.$t("Upload")),1)]),_:1})])])])])]),_:1},8,["title"])]),t("div",me,[a(R,{title:o.$t("Statements_List"),straight:"",class:"list-widget-v3"},{default:l(()=>[t("table",_e,[t("thead",null,[t("tr",null,[t("th",null,e(o.$t("Statement_code")),1),t("th",null,e(o.$t("Drug_name")),1),t("th",null,e(o.$t("Status")),1)])]),t("tbody",null,[(i(!0),m(W,null,ft(g.value,w=>(i(),m("tr",null,[t("td",null,[a(Q,{class:"has-text-primary",to:`/app/statements/${w.id}`},{default:l(()=>[D(e(w.code),1)]),_:2},1032,["to"])]),t("td",null,e(w.drug),1),t("td",null,[a(X,{"justify-content":"space-between"},{default:l(()=>[a(at,null,{default:l(()=>[a(q,{class:"is-size-6",color:w.is_paid?"primary":"warning",rounded:"",label:w.is_paid?o.$t("Paid"):o.$t("Not_Paid")},null,8,["color","label"])]),_:2},1024),w.is_paid&&!u.value?.verified_at?(i(),U(at,{key:0},{default:l(()=>[a(x,{color:"warning",rounded:"",textContent:e(o.$t("Reject_statement_status")),onClick:H=>z(w.id)},null,8,["textContent","onClick"])]),_:2},1024)):C("",!0)]),_:2},1024)])]))),256))])])]),_:1},8,["title"])])]),a(Z,{modelValue:d.value,"onUpdate:modelValue":y[2]||(y[2]=w=>d.value=w),"item-id":Number(V(p)),"onUpdate:list":y[3]||(y[3]=()=>{v(),O(),p.value=""})},null,8,["modelValue","item-id"]),a(tt,{modelValue:S.value,"onUpdate:modelValue":y[4]||(y[4]=w=>S.value=w),"contract-id":V(p),onClose:v,"file-prop-name":$.value,"onUpdate:data":y[5]||(y[5]=()=>{v(),P()})},null,8,["modelValue","contract-id","file-prop-name"]),a(et,{onConfirmAction:h})])}}}),pe=_t(fe,[["__scopeId","data-v-33774ae6"]]),he={class:"table is-bordered is-fullwidth"},ye={class:"has-text-weight-bold"},ve={class:"has-text-right is-size-5 has-text-weight-bold"},be={class:"has-text-weight-bold"},$e={class:"has-text-right is-size-5 has-text-weight-bold"},ge={colspan:"2",class:"is-size-5 has-text-weight-bold"},we={key:0},Ve={key:1},Ce=j({props:{contract:null,modelValue:null},emits:["update:modelValue","confirmAction"],setup(c,{emit:n}){const f=st(),s=nt(()=>f.confirmModalOkButtonColor);async function I(){f.$patch({confirmState:!0}),b(),n("confirmAction")}function b(){n("update:modelValue",!1)}return(r,k)=>{const S=Ft,N=x,p=ot;return i(),U(p,{open:c.modelValue,actions:"center",title:r.$t("Confirm_action"),noclose:!0,onClose:b,"cancel-label":r.$t("No")},{content:l(()=>[a(S,{title:r.$t("Are_you_sure")+"?"},null,8,["title"]),t("table",he,[t("tbody",null,[t("tr",null,[t("td",null,[t("span",ye,e(r.$t("Contract_sum")),1)]),t("td",ve,[t("span",null,e(c.contract.payment_amount.toLocaleString()),1)])]),t("tr",null,[t("td",null,[t("span",be,e(r.$t("Payment_total_sum")),1)]),t("td",$e,[t("span",null,e(c.contract.payment_total_sum.toLocaleString()),1)])]),t("tr",null,[t("td",ge,[c.contract.payment_amount>c.contract.payment_total_sum?(i(),m("span",we,e(r.$t("Contract_sum_more"))+": "+e((c.contract.payment_amount-c.contract.payment_total_sum).toLocaleString()),1)):c.contract.payment_amount<c.contract.payment_total_sum?(i(),m("span",Ve,e(r.$t("Contract_sum_less"))+": "+e((c.contract.payment_total_sum-c.contract.payment_amount).toLocaleString()),1)):C("",!0)])])])])]),action:l(()=>[a(N,{type:"button",class:"is-justify-content-center",color:V(s),outlined:"",onClick:I},{default:l(()=>[D(e(r.$t("Yes")),1)]),_:1},8,["color"])]),_:1},8,["open","title","cancel-label"])}}}),K=pt();async function ke(c,n){try{const{data:f}=await K({url:`/api/admin/payment/${c}/verify`,method:"PUT",data:{applications:n}});return f.data}catch(f){throw f}}async function Se(c){try{const{data:n}=await K({url:`/api/admin/payment/${c}/cancel`,method:"PUT"});return n.data}catch(n){throw n}}async function Ne(c){try{const{data:n}=await K({url:`/api/admin/appcontract/${c}/verify`,method:"PUT"});return n.data}catch(n){throw n}}async function Me(c){try{const{data:n}=await K({url:`/api/admin/appcontract/${c}/application/not-verified`,method:"GET"});return n.data}catch(n){throw n}}const Pe=["onSubmit"],De={class:"columns is-multiline"},Ae={class:"column is-12"},Ie={class:"help has-text-danger"},Fe=j({props:{modelValue:Boolean,paymentId:{type:Number,default:null}},emits:["update:modelValue","update:list"],async setup(c,{emit:n}){let f,s;const I=c,{t:b,locale:r}=E(),S=J().params?.id??null;let N=_(b("Verify_payment"));const p=_(),u=_([]),g=ht({applications:""});[f,s]=lt(()=>$()),await f,s();async function $(){try{const v=await Me(Number(S));p.value=v}catch(v){console.log(v)}}async function d(v){try{await ke(I.paymentId,u.value),n("update:list"),M()}catch(A){Object.assign(g,A.response?.data?.errors)}}function M(){u.value=[],n("update:modelValue",!1)}return(v,A)=>{const L=G("Multiselect"),z=yt,O=vt,h=x,P=ot;return i(),U(P,{open:c.modelValue,size:"large",title:V(N),actions:"right",onClose:M},{content:l(()=>[t("form",{id:"payment-verify-form",class:"modal-form",onSubmit:ct(d,["prevent"]),style:{"min-height":"200px"}},[t("div",De,[t("div",Ae,[a(O,null,{default:l(({id:o})=>[a(z,null,{default:l(()=>[a(L,{modelValue:u.value,"onUpdate:modelValue":A[0]||(A[0]=y=>u.value=y),attrs:{id:o},searchable:!1,options:p.value,placeholder:v.$t("Select_statements"),valueProp:"id",label:"code",mode:"tags","close-on-select":!1,"append-new-option":!1},null,8,["modelValue","attrs","options","placeholder"])]),_:2},1024)]),_:1}),t("p",Ie,e(V(g).applications[0]),1)])])],40,Pe)]),action:l(({close:o})=>[a(h,{color:"primary",outlined:"",type:"submit",form:"payment-verify-form"},{default:l(()=>[D(e(v.$t("Save")),1)]),_:1})]),_:1},8,["open","title"])}}}),Ue={class:"applicant-list-wrapper"},xe={class:"is-size-3 mb-3"},Le=["textContent"],Be=["href"],Te={class:"mr-3"},Ye=j({async setup(c){let n,f;const{t:s,locale:I}=E(),r=J().params?.id??null,k=st(),S=rt(),N=_(),p=_(),u={orderNumber:{format:(h,P,o)=>`${o+1}`,cellClass:"is-flex-grow-0"},file:{label:s("Invoice"),grow:!0},amount:{label:s("Amount")},status:{label:s("Status")},created_at:{label:s("Paid_date")},verified_at:{label:s("Verified_date")},actions:{label:s("Actions"),align:"center"}},g=_(!1),$=_(!1);[n,f]=lt(()=>d()),await n,f();async function d(){const h=await kt(Number(r));N.value=await h}async function M(h){p.value=h,g.value=!0}async function v(){$.value=!0}async function A(h){p.value=h,k.$patch({confirmModalState:!0})}async function L(){await Ne(r),await d()}async function z(){await Se(p.value),await d()}function O(){S.success(s("Updated_successfully"))}return(h,P)=>{const o=at,y=x,B=ut,q=G("VueIconify"),R=Lt,Q=xt,X=Pt,Z=Dt,tt=Fe,et=Ce,w=it;return i(),m("div",Ue,[a(B,{class:"mb-4","flex-wrap":"wrap"},{default:l(()=>[a(o,null,{default:l(()=>[t("h1",xe,e(h.$t("Payments")),1)]),_:1}),a(o,{class:"ml-auto"},{default:l(()=>[N.value?.verified_at?C("",!0):(i(),U(y,{key:0,type:"button",rounded:"",color:"primary",icon:"feather:check",onClick:v},{default:l(()=>[D(e(h.$t("Verify_contract")),1)]),_:1}))]),_:1})]),_:1}),a(Z,{columns:V(u),data:N.value.payments},{default:l(H=>[a(X,{rounded:""},{"header-column":l(({column:T})=>[T.key==="orderNumber"?(i(),m("span",{key:0,class:"is-flex-grow-0",textContent:e("#")},null,8,Le)):C("",!0)]),"body-cell":l(({row:T,column:Y,value:F})=>[Y.key==="file"?(i(),m("a",{key:0,href:T.file,class:"has-text-primary is-pushed-mobile"},[t("span",Te,e(h.$t("Download")),1),a(q,{icon:"feather:link"})],8,Be)):C("",!0),Y.key==="amount"?(i(),m(W,{key:1},[D(e(Number(F).toLocaleString()),1)],64)):C("",!0),Y.key==="status"&&F?(i(),U(R,{key:2,status:F},null,8,["status"])):C("",!0),Y.key==="created_at"&&F?(i(),m(W,{key:3},[D(e(h.$h.formatDate(F,"DD.MM.YYYY HH:mm")),1)],64)):C("",!0),Y.key==="verified_at"&&F?(i(),m(W,{key:4},[D(e(h.$h.formatDate(F,"DD.MM.YYYY HH:mm")),1)],64)):C("",!0),Y.key==="actions"?(i(),m(W,{key:5},[T.status?.color==="warning"?(i(),U(Q,{key:0},{default:l(()=>[a(y,{class:"is-primary is-outlined px-3",onClick:dt=>M(T.id)},{default:l(()=>[D(e(h.$t("Verify")),1)]),_:2},1032,["onClick"]),a(y,{class:"is-danger is-outlined px-3",onClick:dt=>A(T.id)},{default:l(()=>[D(e(h.$t("Cancel")),1)]),_:2},1032,["onClick"])]),_:2},1024)):C("",!0)],64)):C("",!0)]),_:1})]),_:1},8,["columns","data"]),a(tt,{modelValue:g.value,"onUpdate:modelValue":P[0]||(P[0]=H=>g.value=H),"payment-id":Number(p.value),"onUpdate:list":P[1]||(P[1]=()=>{d(),O()})},null,8,["modelValue","payment-id"]),a(et,{modelValue:$.value,"onUpdate:modelValue":P[2]||(P[2]=H=>$.value=H),contract:N.value,onConfirmAction:L},null,8,["modelValue","contract"]),a(w,{onConfirmAction:z})])}}}),je={class:"statement-detail-wrapper"},ze={key:0,class:"columns mt-5"},Oe={key:1,class:"mt-5"},sa=j({setup(c){const{t:n,locale:f}=E(),s=J(),I=s.params?.id??null,b=_(s.hash.slice(1)||"details"),r=_([{label:n("Contract_details"),value:"details",icon:"lnil lnil-tap"},{label:n("Payment"),value:"payment",icon:"fas fa-tree"}]),k=_(),S=_(),N=_();return Ut().setPageTitle(n("Contract_card")),bt({title:nt(()=>n("Contract_card"))}),$t(async()=>{const u=await St(Number(I)),g=await Nt(Number(I));k.value=u,S.value=g,N.value=g.map(($,d)=>d)}),(u,g)=>{const $=pe,d=mt;return i(),m("div",je,[a(d,{selected:b.value,tabs:r.value},{tab:l(({activeValue:M})=>[M==="details"?(i(),m("div",ze,[a($)])):C("",!0),M==="payment"?(i(),m("div",Oe,[a(Ye)])):C("",!0)]),_:1},8,["selected","tabs"])])}}});export{sa as default};
